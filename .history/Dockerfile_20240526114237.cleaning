# Start with the official Airflow image for version 2.9.1
FROM apache/airflow:2.9.1

# Set the working directory
WORKDIR /opt/airflow

# Install any necessary dependencies
RUN pip install --no-cache-dir \
    requests \
    pandas \
    nltk

# Copy the data cleaning DAG file into the DAGs directory
COPY dags/data_cleaning.py /opt/airflow/dags/

# Copy other necessary files (e.g., the api controllers and scripts) if needed
COPY api/controllers /opt/airflow/api/controllers
COPY scripts/clean_data.py /opt/airflow/scripts/

# Ensure the permissions are set correctly
RUN chmod -R 755 /opt/airflow/dags /opt/airflow/api /opt/airflow/scripts

# Set environment variables (optional, for Airflow configuration)
ENV AIRFLOW__CORE__EXECUTOR=LocalExecutor
ENV AIRFLOW__CORE__SQL_ALCHEMY_CONN=sqlite:////opt/airflow/airflow.db

# Command to start the Airflow scheduler and web server
CMD ["airflow", "standalone"]

